$(document).ready(function(){var o=0;var n=0;var F=0;var U="ARS";var f="Gray";var aa=10;var ad=20;function m(){this.Playfields=new Array();this.current_playfield;this.init=function(){this.Playfields.push(new G());this.current_playfield=this.Playfields.length-1;this.Playfields[0].init();var an="";an+='<div id="top-box">';an+='<div id="holdbox"></div>';an+='<div id="next1box"></div>';an+='<div id="next2box"></div>';an+='<div id="next3box"></div>';an+="</div>";an+='<table id="diagram"> \n';for(var D=0;D<26;D++){an+='<tr class="row'+D+'">';for(var am=0;am<26;am++){an+='<td id="p'+am+"x"+D+'" class="col'+am+'"><div class="inactivelayer"><div class="pixelborder"><div class="activelayer"><div class="decorationlayer"><div class="previewlayer"></div></div></div></div></div></td>'}an+="</tr> \n"}an+="</table> \n";$("#seed").prepend(an);for(var am=0;am<26;am++){if(am<20){for(var D=10;D<26;D++){$(".col"+D,"#diagram").addClass("hidden")}}else{$(".row"+am,"#diagram").addClass("hidden")}}};this.new_playfield=function(){this.Playfields.splice(this.current_playfield+1,0,new G());this.current_playfield+=1;this.Playfields[this.current_playfield].init();this.Playfields[this.current_playfield].draw();this.update_framecount()};this.new_copy_playfield=function(){var D=this.Playfields[this.current_playfield].print();this.new_playfield();this.Playfields[this.current_playfield].load_pf(D)};this.remove_current_playfield=function(){if(this.Playfields.length>1){if(this.current_playfield-1>=0){this.current_playfield-=1;this.Playfields.splice(this.current_playfield+1,1)}else{this.Playfields.splice(this.current_playfield,1);this.current_playfield=0}this.Playfields[this.current_playfield].draw();this.update_framecount()}};this.remove_following_playfields=function(){this.Playfields.splice(this.current_playfield+1);this.update_framecount()};this.remove_all_playfields=function(){this.Playfields.splice(1);this.Playfields[0].init();this.current_playfield=0;this.Playfields[this.current_playfield].draw();this.update_framecount();this.Playfields[this.current_playfield].change_size(10,20)};this.next_playfield=function(){if(this.current_playfield+1<this.Playfields.length){this.current_playfield+=1;$("#border_color").val(z.Playfields[z.current_playfield].border_color)}this.Playfields[this.current_playfield].draw();this.update_framecount()};this.previous_playfield=function(){if(this.current_playfield-1>=0){this.current_playfield-=1;this.Playfields[this.current_playfield].draw();this.update_framecount()}};this.first_playfield=function(){this.current_playfield=0;this.Playfields[this.current_playfield].draw();this.update_framecount()};this.last_playfield=function(){this.current_playfield=this.Playfields.length-1;this.Playfields[this.current_playfield].draw();this.update_framecount()};this.update_framecount=function(){$("#current-frame").html(this.current_playfield+1);$("#total-frame").html(this.Playfields.length)};this.set_system_to_all=function(am){for(var D=0;D<this.Playfields.length;D++){this.Playfields[D].system=am}this.Playfields[this.current_playfield].modify_system(am)};this.set_default_system=function(D){U=D};this.set_border_to_all=function(am){for(var D=0;D<this.Playfields.length;D++){this.Playfields[D].border_color=am}this.Playfields[this.current_playfield].modify_border(am)};this.set_default_border=function(D){f=D};this.change_size_to_all=function(){};this.print=function(){var am="";for(var D=0;D<this.Playfields.length;D++){am+=this.Playfields[D].print()+"+"}return am};this.save=function(){$("#export").html(this.print())};this.export_all_to_forum=function(){$("#export").html("[tedige]"+this.print()+"[/tedige]")};this.load=function(D){this.remove_all_playfields();if(!D){return}var an=D.split("+");for(var am=0;am<an.length-1;am++){this.Playfields[this.current_playfield].load_pf(an[am]);if(am<an.length-2){this.new_playfield()}}};this.export_all_to_url=function(){var D=window.location.protocol+window.location.hostname;var an=window.location.pathname.split("/");for(var am=0;am<an.length-1;am++){D+=an[am]+"/"}D+="view.html";$("#export").html(D+"?"+this.print())};this.export_all_to_edit_url=function(){var D=window.location.protocol+window.location.hostname;var an=window.location.pathname.split("/");for(var am=0;am<an.length-1;am++){D+=an[am]+"/"}D+="tedige.html";$("#export").html(D+"?"+this.print())}}function G(){this.pf_width=aa;this.pf_height=ad;this.comment="";this.Tetrion=new Array();this.system=U;this.stackborder_status;this.border_color=f;this.hold="";this.next1="";this.next2="";this.next3="";this.the_active_center=new Array();this.the_active_center.coord="";this.the_active_center.piece="";this.Tetrion_History=new Array();this.init=function(){for(var am=0;am<26;am++){this.Tetrion.push(new Array(26));for(var D=0;D<this.pf_height;D++){this.Tetrion[am][D]=new Array();this.Tetrion[am][D]["content"]="_";this.Tetrion[am][D]["content_active"]="";this.Tetrion[am][D]["decoration"]=""}}};this.modify=function(D,ap,ao){this.Tetrion[D][ap]["content"]=ao;var am=$("#p"+D+"x"+ap);var an=am.find(".inactivelayer");am.removeClass("haspreview hasinactive foreground-inactive");if(ao=="_"){an.attr("class","inactivelayer")}else{if(this.Tetrion[D][ap]["content_active"]){}else{an.attr("class","inactivelayer").addClass("piece-"+ao);am.addClass("hasinactive foreground-inactive")}}if(this.stackborder_status){if(ap>=0&&this.Tetrion[D][ap]["content"]=="_"){this.stackborder(D,ap)}if(ap-1>=0&&this.Tetrion[D][ap-1]["content"]=="_"){this.stackborder(D,ap-1)}if(D+1<this.pf_width&&this.Tetrion[D+1][ap]["content"]=="_"){this.stackborder(D+1,ap)}if(ap+1<this.pf_height&&this.Tetrion[D][ap+1]["content"]=="_"){this.stackborder(D,ap+1)}if(D-1>=0&&this.Tetrion[D-1][ap]["content"]=="_"){this.stackborder(D-1,ap)}}};this.modify_active=function(am,ap,ao){this.Tetrion[am][ap]["content_active"]=ao;var an=$("#p"+am+"x"+ap);var D=an.find(".activelayer");an.removeClass("inactive haspreview foreground-inactive");if(ao){D.attr("class","activelayer").addClass("piece-"+ao);an.addClass("hasactive")}else{D.attr("class","activelayer");an.removeClass("hasactive");if(this.Tetrion[am][ap]["content"]!="_"){an.addClass("foreground-inactive")}}};this.modify_active_center=function(D,an,am){this.the_active_center.coord=D+"x"+an;this.the_active_center.piece=am};this.modify_preview=function(D,ap,an){var am=$("#p"+D+"x"+ap);var ao=am.find(".previewlayer");am.removeClass("haspreview");ao.removeClass("transparent-preview");if(an){am.addClass("haspreview");ao.addClass("transparent-preview")}};this.modify_decoration=function(D,ao,an){this.Tetrion[D][ao]["decoration"]=an;var am=$("#p"+D+"x"+ao).find(".decorationlayer");am.attr("class","decorationlayer").addClass(an)};this.modify_set_piece=function(ar,au,at,am){var D=new Array();D.x=parseFloat(ar.slice(1,ar.indexOf("x")));D.y=parseFloat(ar.slice(ar.indexOf("x")+1));var an=O(am,D,this.system);var aq=new Array();var ap=new Array();var ao=new Array();aq.x=parseFloat(D.x);aq.y=parseFloat(D.y);ap.x=parseFloat(D.x);ap.y=parseFloat(D.y);ao.x=parseFloat(D.x);ao.y=parseFloat(D.y);if(an[0].x>=0){aq.x=parseFloat(an[0].x);aq.y=parseFloat(an[0].y);ap.x=parseFloat(an[1].x);ap.y=parseFloat(an[1].y);ao.x=parseFloat(an[2].x);ao.y=parseFloat(an[2].y)}if($("#drop:checked").val()){while(this.is_in(D.x,D.y)&&this.is_in(aq.x,aq.y)&&this.is_in(ap.x,ap.y)&&this.is_in(ao.x,ao.y)&&this.Tetrion[D.x][D.y]["content"]=="_"&&this.Tetrion[aq.x][aq.y]["content"]=="_"&&this.Tetrion[ap.x][ap.y]["content"]=="_"&&this.Tetrion[ao.x][ao.y]["content"]=="_"){D.y=parseFloat(D.y)+1;an=O(am,D,this.system);aq.x=an[0].x;aq.y=an[0].y;ap.x=an[1].x;ap.y=an[1].y;ao.x=an[2].x;ao.y=an[2].y}D.y=parseFloat(D.y)-1;an=O(am,D,this.system);aq.x=an[0].x;aq.y=an[0].y;ap.x=an[1].x;ap.y=an[1].y;ao.x=an[2].x;ao.y=an[2].y}if(this.is_in(aq.x,aq.y)&&this.is_in(ap.x,ap.y)&&this.is_in(ao.x,ao.y)){switch(au){case"active":this.rebootActive();this.modify_active(D.x,D.y,at);this.modify_active_center(D.x,D.y,am);this.modify_active(aq.x,aq.y,at);this.modify_active(ap.x,ap.y,at);this.modify_active(ao.x,ao.y,at);break;case"inactive":this.Tetrion_History_Save();this.modify(D.x,D.y,at);this.modify(aq.x,aq.y,at);this.modify(ap.x,ap.y,at);this.modify(ao.x,ao.y,at);this.modify_preview(D.x,D.y,false);this.modify_preview(aq.x,aq.y,false);this.modify_preview(ap.x,ap.y,false);this.modify_preview(ao.x,ao.y,false);break;case"addpreview":this.modify_preview(D.x,D.y,true);this.modify_preview(aq.x,aq.y,true);this.modify_preview(ap.x,ap.y,true);this.modify_preview(ao.x,ao.y,true);break;case"removepreview":this.modify_preview(D.x,D.y,false);this.modify_preview(aq.x,aq.y,false);this.modify_preview(ap.x,ap.y,false);this.modify_preview(ao.x,ao.y,false);break}}};this.rectangular_fill=function(an,aw,am,D,aq){var av=Math.min(an,am);var au=Math.max(an,am);var at=Math.min(aw,D);var ar=Math.max(aw,D);for(var ap=av;ap<=au;ap++){for(var ao=at;ao<=ar;ao++){this.modify(ap,ao,aq)}}};this.recursive_fill=function(D,ao,an,am){D=parseFloat(D);ao=parseFloat(ao);if(this.Tetrion[D][ao]["content"]!=an){return}this.modify(D,ao,am);if(ao-1>=0){this.recursive_fill(D,ao-1,an,am)}if(ao+1<this.pf_height){this.recursive_fill(D,ao+1,an,am)}if(D+1<this.pf_width){this.recursive_fill(D+1,ao,an,am)}if(D-1>=0){this.recursive_fill(D-1,ao,an,am)}};this.shift_field=function(D){if(D=="up"){for(j=0;j<this.pf_height-1;j++){for(i=0;i<this.pf_width;i++){this.modify(i,j,this.Tetrion[i][j+1]["content"])}}for(i=0;i<this.pf_width;i++){this.modify(i,this.pf_height-1,"_")}}if(D=="down"){for(j=this.pf_height-1;j>0;j--){for(i=0;i<this.pf_width;i++){this.modify(i,j,this.Tetrion[i][j-1]["content"])}}for(i=0;i<this.pf_width;i++){this.modify(i,0,"_")}}if(D=="left"){for(i=0;i<this.pf_width-1;i++){for(j=0;j<this.pf_height;j++){this.modify(i,j,this.Tetrion[i+1][j]["content"])}}for(j=0;j<this.pf_height;j++){this.modify(this.pf_width-1,j,"_")}}if(D=="right"){for(i=this.pf_width-1;i>0;i--){for(j=0;j<this.pf_height;j++){this.modify(i,j,this.Tetrion[i-1][j]["content"])}}for(j=0;j<this.pf_height;j++){this.modify(0,j,"_")}}};this.modify_system=function(D){this.system=D;$("#system").val(D);if(D){$("#style-blocks").attr("href","ressources/"+D+".css")}else{$("#style-blocks").attr("href","ressources/ARS.css")}};this.modify_border=function(D){this.border_color=D;$diagram=$("#diagram");switch(this.border_color){case"gray":$diagram.css("border","5px solid gray");break;case"yellow":$diagram.css("border","5px solid yellow");break;case"blue":$diagram.css("border","5px solid blue");break;case"red":$diagram.css("border","5px solid red");break;case"green":$diagram.css("border","5px solid green");break;case"clear":$diagram.css("border","5px solid transparent");break;case"none":$diagram.css("border","5px solid transparent");break;default:$diagram.css("border","5px solid gray");break}$("#border_color").val(D)};this.stackborder=function(D,an){var am="";$pixelborder=$("#p"+D+"x"+an).find(".pixelborder");$pixelborder.attr("class","pixelborder");if(this.Tetrion[D][an]["content"]=="_"){am+="border-";if(an-1>=0&&this.Tetrion[D][an-1]["content"]!="_"){am+="top"}if(D+1<this.pf_width&&this.Tetrion[D+1][an]["content"]!="_"){am+="right"}if(an+1<this.pf_height&&this.Tetrion[D][an+1]["content"]!="_"){am+="bottom"}if(D-1>=0&&this.Tetrion[D-1][an]["content"]!="_"){am+="left"}}if(am){$pixelborder.addClass(am)}};this.draw_stackborder=function(D){var ap="";for(var ao=0;ao<this.pf_width;ao++){for(var an=0;an<this.pf_height;an++){var am=$("#p"+ao+"x"+an).find(".pixelborder");am.attr("class","pixelborder");if(this.Tetrion[ao][an]["content"]=="_"){if(this.Tetrion[ao][an]["content_active"]==""){if(D){ap+="border-";if(an-1>=0&&this.Tetrion[ao][an-1]["content"]!="_"){ap+="top"}if(ao+1<this.pf_width&&this.Tetrion[ao+1][an]["content"]!="_"){ap+="right"}if(an+1<this.pf_height&&this.Tetrion[ao][an+1]["content"]!="_"){ap+="bottom"}if(ao-1>=0&&this.Tetrion[ao-1][an]["content"]!="_"){ap+="left"}}if(ap){am.addClass(ap)}ap=""}}}}};this.save_comment=function(){this.comment=$("#com").val()};this.paint_active=function(){for(var am=0;am<this.pf_width;am++){for(var D=0;D<this.pf_height;D++){if(this.Tetrion[am][D]["content_active"]){this.modify(am,D,this.Tetrion[am][D]["content_active"])}}}};this.lock_active=function(){this.paint_active();this.rebootActive()};this.drop_active=function(){};this.lookup_block=function(ap){var an=ap.indexOf("p");var am=ap.indexOf("x");var D=parseInt(ap.substring(an+1,am));var ao=parseInt(ap.substring(am+1));return this.Tetrion[D][ao]["content"]};this.lookup_decoration=function(ap){var an=ap.indexOf("p");var am=ap.indexOf("x");var D=parseInt(ap.substring(an+1,am));var ao=parseInt(ap.substring(am+1));return this.Tetrion[D][ao]["decoration"]};this.spawn_piece=function(ao){var an=parseInt(this.pf_width)/2;var am=3;var D="p"+an+"x0";this.modify_set_piece(D,"active",ao,ao+"i")};this.move_piece=function(au){var ao=this.the_active_center.coord.split("x");var am=this.the_active_center.piece;var at=new Array;at.x=ao[0];at.y=ao[1];var av=am.slice(0,1);var D=am.slice(1);switch(au){case"none":at.x=parseFloat(at.x);at.y=parseFloat(at.y);break;case"up":at.x=parseFloat(at.x);at.y=parseFloat(at.y)-1;break;case"down":at.x=parseFloat(at.x);at.y=parseFloat(at.y)+1;break;case"left":at.x=parseFloat(at.x)-1;at.y=parseFloat(at.y);break;case"right":at.x=parseFloat(at.x)+1;at.y=parseFloat(at.y);break;case"cw":if(D){switch(D){case"i":D="cw";break;case"cw":D="u";break;case"u":D="ccw";break;case"ccw":D="i";break}}am=av+D;break;case"ccw":if(D){switch(D){case"i":D="ccw";break;case"ccw":D="u";break;case"u":D="cw";break;case"cw":D="i";break}}am=av+D;break}var an=O(am,at,this.system);var ar=new Array();var aq=new Array();var ap=new Array();ar.x=an[0].x;ar.y=an[0].y;aq.x=an[1].x;aq.y=an[1].y;ap.x=an[2].x;ap.y=an[2].y;if(am=="T"||am=="L"||am=="J"||am=="S"||am=="Z"||am=="I"||am=="G"){ar.x=at.x;ar.y=at.y;aq.x=at.x;aq.y=at.y;ap.x=at.x;ap.y=at.y}if(this.is_in(ar.x,ar.y)&&this.is_in(aq.x,aq.y)&&this.is_in(ap.x,ap.y)){if($("input#collision:checked").val()){if(this.Tetrion[at.x][at.y]["content"]=="_"&&this.Tetrion[ar.x][ar.y]["content"]=="_"&&this.Tetrion[aq.x][aq.y]["content"]=="_"&&this.Tetrion[ap.x][ap.y]["content"]=="_"){this.rebootActive();this.modify_active(at.x,at.y,av);this.modify_active_center(at.x,at.y,am);this.modify_active(ar.x,ar.y,av);this.modify_active(aq.x,aq.y,av);this.modify_active(ap.x,ap.y,av)}}else{this.rebootActive();this.modify_active(at.x,at.y,av);this.modify_active_center(at.x,at.y,am);this.modify_active(ar.x,ar.y,av);this.modify_active(aq.x,aq.y,av);this.modify_active(ap.x,ap.y,av)}}};this.drop_active_piece=function(){var ao=this.the_active_center.coord.split("x");var am=this.the_active_center.piece;var at=new Array;var au=am.slice(0,1);var D=am.slice(1);at.x=ao[0];at.y=ao[1];var an=O(am,at,this.system);var ar=new Array();var aq=new Array();var ap=new Array();ar.x=an[0].x;ar.y=an[0].y;aq.x=an[1].x;aq.y=an[1].y;ap.x=an[2].x;ap.y=an[2].y;at.x=parseFloat(at.x);at.y=parseFloat(at.y)+1;an=O(am,at,this.system);if($("#collision:checked").val()){while(this.is_in(ar.x,ar.y)&&this.is_in(aq.x,aq.y)&&this.is_in(ap.x,ap.y)&&this.Tetrion[at.x][at.y]["content"]=="_"&&this.Tetrion[ar.x][ar.y]["content"]=="_"&&this.Tetrion[aq.x][aq.y]["content"]=="_"&&this.Tetrion[ap.x][ap.y]["content"]=="_"){at.y=parseFloat(at.y)+1;an=O(am,at,this.system);ar.x=an[0].x;ar.y=an[0].y;aq.x=an[1].x;aq.y=an[1].y;ap.x=an[2].x;ap.y=an[2].y}}else{while(this.is_in(ar.x,ar.y)&&this.is_in(aq.x,aq.y)&&this.is_in(ap.x,ap.y)){at.y=parseFloat(at.y)+1;an=O(am,at,this.system);ar.x=an[0].x;ar.y=an[0].y;aq.x=an[1].x;aq.y=an[1].y;ap.x=an[2].x;ap.y=an[2].y}}at.y=parseFloat(at.y)-1;an=O(am,at,this.system);ar.x=an[0].x;ar.y=an[0].y;aq.x=an[1].x;aq.y=an[1].y;ap.x=an[2].x;ap.y=an[2].y;this.rebootActive();this.modify_active(at.x,at.y,au);this.modify_active_center(at.x,at.y,am);this.modify_active(ar.x,ar.y,au);this.modify_active(aq.x,aq.y,au);this.modify_active(ap.x,ap.y,au)};this.change_size=function(D,am){if(this.pf_height!=am||this.pf_width!=D){this.pf_height=am;this.pf_width=D;aa=D;ad=am}};this.change_size_display=function(){for(var am=0;am<26;am++){$(".row"+am,"#diagram").removeClass("hidden");for(var D=0;D<this.pf_width;D++){$(".col"+D,"#diagram").removeClass("hidden")}}for(var am=0;am<26;am++){if(am<this.pf_height){for(var D=this.pf_width;D<26;D++){$(".col"+D,"#diagram").addClass("hidden")}}else{$(".row"+am,"#diagram").addClass("hidden")}}};this.modify_hold=function(am){this.hold=am;var D=$("#holdbox");$("#hold").val(am);D.attr("class","holdbox").addClass("hold-"+am)};this.modify_next1=function(am){this.next1=am;var D=$("#next1box");$("#next1").val(am);D.attr("class","next1box").addClass("next1-"+am)};this.modify_next2=function(am){this.next2=am;var D=$("#next2box");$("#next2").val(am);D.attr("class","next2box").addClass("next2-"+am)};this.modify_next3=function(am){this.next3=am;var D=$("#next3box");$("#next3").val(am);D.attr("class","next3box").addClass("next3-"+am)};this.switchhold=function(){var D=this.the_active_center.piece.slice(0,1);this.rebootActive();if(this.hold){this.spawn_piece(this.hold);this.modify_hold("")}this.modify_hold(D)};this.advance_next=function(){this.modify_next1(this.next2);this.modify_next2(this.next3);this.modify_next3("")};this.line_clear=function(){for(var am=0;am<=this.pf_height-1;am++){var D=0;for(var an=0;an<this.pf_width;an++){if(this.Tetrion[an][am]["content"]!="_"){D++}}if(D==this.pf_width){for(k=am;k>-1;k--){if(k!=0){for(an=0;an<this.pf_width;an++){this.modify(an,k,this.Tetrion[an][k-1]["content"])}}else{for(an=0;an<this.pf_width;an++){this.modify(an,k,"_")}}}}}};this.print=function(){var ap="";var an="";var ar;var ao;if(this.pf_height!=20||this.pf_width!=10){ap+="*s"+this.pf_width+"x"+this.pf_height+"_"}if(this.system){ap+="*r"+this.system+"_"}if(this.border_color){ap+="*b"+this.border_color+"_"}if(this.hold){ap+="*h"+this.hold+"_"}if(this.next1){ap+="*n"+this.next1+"_"}if(this.next2){ap+="*m"+this.next2+"_"}if(this.next3){ap+="*o"+this.next3+"_"}for(var D=0;D<this.pf_height;D++){for(var am=0;am<this.pf_width;am++){if(this.Tetrion[am][D]["content"]!="_"){ar=ai(am);ao=ai(D);an+=ar+ao+this.Tetrion[am][D]["content"]+"-"}}}if(an){ap+="*g";ap+=an+"_";an=""}if(this.the_active_center.piece){var aq=this.the_active_center.coord.split("x");ar=ai(parseInt(aq[0]));ao=ai(parseInt(aq[1]));an+=ar+ao+"-"+this.the_active_center.piece}if(an){ap+="*a";ap+=an+"_";an=""}for(var D=0;D<this.pf_height;D++){for(var am=0;am<this.pf_width;am++){if(this.Tetrion[am][D]["decoration"]){ar=ai(am);ao=ai(D);an+=ar+ao+this.Tetrion[am][D]["decoration"]+"-"}}}if(an){ap+="*d";ap+=an+"_";an=""}if(this.comment){this.comment=this.comment.replace("<strong>","html-strong-begin");this.comment=this.comment.replace("</strong>","html-strong-end");this.comment=this.comment.replace("<em>","html-em-begin");this.comment=this.comment.replace("</em>","html-em-end");this.comment=this.comment.replace("<a","html-a-begin");this.comment=this.comment.replace("</a>","html-a-end");this.comment=this.comment.replace(/<(.|\n)*?>/,"");this.comment;this.comment=this.comment.replace("html-strong-begin","<strong>");this.comment=this.comment.replace("html-strong-end","</strong>");this.comment=this.comment.replace("html-em-begin","<em>");this.comment=this.comment.replace("html-em-end","</em>");this.comment=this.comment.replace("html-a-begin","<a");this.comment=this.comment.replace("html-a-end","</a>");ap+="*c"+encodeURIComponent(ae.encode(this.comment))}if(this.stackborder_status){ap+="*w"}return ap};this.export_pf=function(){$("#export").html(this.print())};this.load_pf=function(ax){this.rebootPlayfield();this.rebootActive();if(!ax){return}this.change_size(10,20);var aC=ax.split("_");for(var az=0;az<aC.length;az++){if(aC[az].charAt(0)=="*"){switch(aC[az].charAt(1)){case"s":var aB=aC[az].slice(2).split("x");var ao=parseFloat(aB[0]);var aA=parseFloat(aB[1]);this.change_size(ao,aA);this.change_size_display();break;case"r":this.modify_system(aC[az].slice(2));break;case"b":this.modify_border(aC[az].slice(2));break;case"h":this.modify_hold(aC[az].slice(2));break;case"n":this.modify_next1(aC[az].slice(2));break;case"m":this.modify_next2(aC[az].slice(2));break;case"o":this.modify_next3(aC[az].slice(2));break;case"g":var am=aC[az].slice(2).split("-");var ar;var ap;for(var ay=0;ay<am.length-1;ay++){ar=ai(am[ay].charAt(0));ap=ai(am[ay].charAt(1));this.modify(ar,ap,am[ay].charAt(2))}break;case"d":var am=aC[az].slice(2).split("-");var ar;var ap;for(var ay=0;ay<am.length-1;ay++){ar=ai(am[ay].charAt(0));ap=ai(am[ay].charAt(1));this.modify_decoration(ar,ap,am[ay].slice(2))}break;case"a":var D=aC[az].slice(2).split("-");var aD=new Array;aD.x=ai(D[0].charAt(0));aD.y=ai(D[0].charAt(1));var aw=D[1].slice(0,1);var aq=D[1];var an=O(aq,aD,this.system);var av=new Array();var au=new Array();var at=new Array();av.x=an[0].x;av.y=an[0].y;au.x=an[1].x;au.y=an[1].y;at.x=an[2].x;at.y=an[2].y;if(aq=="T"||aq=="L"||aq=="J"||aq=="S"||aq=="Z"||aq=="I"||aq=="G"||aq=="single"){av.x=aD.x;av.y=aD.y;au.x=aD.x;au.y=aD.y;at.x=aD.x;at.y=aD.y}this.rebootActive();this.modify_active(aD.x,aD.y,aw);this.modify_active_center(aD.x,aD.y,aq);this.modify_active(av.x,av.y,aw);this.modify_active(au.x,au.y,aw);this.modify_active(at.x,at.y,aw);break;case"c":this.comment=ae.decode(decodeURIComponent(aC[az].slice(2)));$("#com").val(this.comment);break;case"w":this.stackborder_status=1;this.draw_stackborder(1);break}}}};this.export_to_tw=function(){var an="";an+="&#060;diagram";if(this.border_color!=""){an+=" border="+this.border_color}if(parseInt($("#width").val())!=10){an+=" width="+parseInt($("#width").val())}if(this.system!=""){an+=" system="+this.system}if(this.hold!=""){an+=" hold="+this.hold}if(this.next1!=""){an+=" next="+this.next1;if(this.next2!=""){an+=","+this.next2}if(this.next3!=""){an+=","+this.next3}}an+=">\n";for(var D=0;D<this.pf_height;D++){for(var am=0;am<this.pf_width;am++){if(this.Tetrion[am][D]["content_active"]){an+="|"+this.Tetrion[am][D]["content_active"]}else{if(this.Tetrion[am][D]["content"]=="_"){an+="| "}else{an+="|"+this.Tetrion[am][D]["content"]}}}an+="|\n"}an+="&#060;/diagram>";if($("#com").val()!=""){an+="\n"+$("#com").val()}$("#export").html(an);$("#console-description").html("copy and paste into tetriswiki")};this.export_to_url=function(){var D=window.location.protocol+window.location.hostname;var an=window.location.pathname.split("/");for(var am=0;am<an.length-1;am++){D+=an[am]+"/"}D+="view.html";$("#export").html(D+"#"+this.print())};this.export_to_edit_url=function(){var D=window.location.protocol+window.location.hostname;var an=window.location.pathname.split("/");for(var am=0;am<an.length-1;am++){D+=an[am]+"/"}D+="tedige.html";$("#export").html(D+"#"+this.print())};this.export_to_forum=function(){$("#export").html("[tedige]"+this.print()+"[/tedige]")};this.is_in=function(D,am){if(D<0||am<0||D>=this.pf_width||am>=this.pf_height){return false}return true};this.rebootPlayfield=function(){for(var am=0;am<this.pf_width;am++){for(var D=0;D<this.pf_height;D++){this.Tetrion[am][D]["content"]="_"}}};this.rebootActive=function(){for(var am=0;am<this.pf_width;am++){for(var D=0;D<this.pf_height;D++){this.modify_active(am,D,"");this.modify_active_center(am,D,"")}}};this.draw=function(){this.modify_system(this.system);var D=$("#diagram");this.change_size_display();switch(this.border_color){case"gray":D.css("border","5px solid gray");break;case"yellow":D.css("border","5px solid yellow");break;case"blue":D.css("border","5px solid blue");break;case"red":D.css("border","5px solid red");break;case"green":D.css("border","5px solid green");break;case"clear":D.css("border","5px solid transparent");break;case"none":D.css("border","5px solid transparent");break;default:D.css("border","5px solid gray");break}this.modify_hold(this.hold);this.modify_next1(this.next1);this.modify_next2(this.next2);this.modify_next3(this.next3);var ao="";for(var an=0;an<this.pf_width;an++){for(var am=0;am<this.pf_height;am++){ao=$("#p"+an+"x"+am);$inactivelayer=ao.find(".inactivelayer");$activelayer=ao.find(".activelayer");$decorationlayer=ao.find(".decorationlayer");$inactivelayer.attr("class","inactivelayer");$activelayer.attr("class","activelayer");$decorationlayer.attr("class","decorationlayer");ao.removeClass("haspreview foreground-inactive hasinactive hasactive");if(this.Tetrion[an][am]["content_active"]){$activelayer.addClass("piece-"+this.Tetrion[an][am]["content_active"]);ao.addClass("hasactive");if(this.Tetrion[an][am]["content"]!="_"){ao.addClass("hasinactive")}}if(this.Tetrion[an][am]["content"]!="_"){$inactivelayer.addClass("piece-"+this.Tetrion[an][am]["content"]);ao.addClass("hasinactive foreground-inactive")}if(this.Tetrion[an][am]["decoration"]){$decorationlayer.addClass(this.Tetrion[an][am]["decoration"])}}}$("#com").val(this.comment);if(this.stackborder_status){this.draw_stackborder(this.stackborder_status)}};this.Tetrion_History_Save=function(){this.Tetrion_History.push(this.print())};this.Tetrion_History_Recall=function(){this.load_pf(this.Tetrion_History[this.Tetrion_History.length-1]);this.Tetrion_History.pop()}}function ai(am){var D;switch(am){case"a":D=0;break;case"b":D=1;break;case"c":D=2;break;case"d":D=3;break;case"e":D=4;break;case"f":D=5;break;case"g":D=6;break;case"h":D=7;break;case"i":D=8;break;case"j":D=9;break;case"k":D=10;break;case"l":D=11;break;case"m":D=12;break;case"n":D=13;break;case"o":D=14;break;case"p":D=15;break;case"q":D=16;break;case"r":D=17;break;case"s":D=18;break;case"t":D=19;break;case 0:D="a";break;case 1:D="b";break;case 2:D="c";break;case 3:D="d";break;case 4:D="e";break;case 5:D="f";break;case 6:D="g";break;case 7:D="h";break;case 8:D="i";break;case 9:D="j";break;case 10:D="k";break;case 11:D="l";break;case 12:D="m";break;case 13:D="n";break;case 14:D="o";break;case 15:D="p";break;case 16:D="q";break;case 17:D="r";break;case 18:D="s";break;case 19:D="t";break}return D}function O(aq,D,ar){var ap=new Array();var ao=new Array();var an=new Array();switch(ar){case"ARS":switch(aq){case"Ti":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Tccw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Tcw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Tu":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Ii":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-2;an.y=parseFloat(D.y)+0;break;case"Iccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-2;break;case"Iu":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-2;an.y=parseFloat(D.y)+0;break;case"Icw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-2;break;case"Oi":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ocw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ou":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Occw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Zi":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Zcw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Zu":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Zccw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Si":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Scw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Su":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Sccw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Li":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+0;break;case"Lccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Lcw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)-1;break;case"Lu":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ji":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Jccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Jcw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Ju":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)-1;break;default:ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+0;break}break;case"SRS":switch(aq){case"Ti":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Tcw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+0;break;case"Tu":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Tccw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Ii":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-2;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+0;break;case"Icw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+2;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Iu":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-2;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+0;break;case"Iccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+2;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Oi":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ocw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ou":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Occw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Si":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+0;break;case"Sccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Su":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Scw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Zi":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+0;break;case"Zcw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Zu":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Zccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Li":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Lccw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Lu":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Lcw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Ji":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+0;break;case"Jcw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Ju":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Jccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;default:ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+0;break}break;default:switch(aq){case"Ti":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Tccw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Tcw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Tu":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-1;break;case"Ii":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-2;an.y=parseFloat(D.y)+0;break;case"Iccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-2;break;case"Iu":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-2;an.y=parseFloat(D.y)+0;break;case"Icw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)-2;break;case"Oi":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ocw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ou":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Occw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Zi":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Zcw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Zu":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Zccw":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Si":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Scw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Su":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Sccw":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+1;break;case"Li":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+0;break;case"Lccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Lcw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)-1;break;case"Lu":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Ji":ap.x=parseFloat(D.x)+1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)-1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)+1;break;case"Jccw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)-1;an.x=parseFloat(D.x)+1;an.y=parseFloat(D.y)-1;break;case"Jcw":ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)-1;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+1;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)+1;break;case"Ju":ap.x=parseFloat(D.x)-1;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+1;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)-1;an.y=parseFloat(D.y)-1;break;default:ap.x=parseFloat(D.x)+0;ap.y=parseFloat(D.y)+0;ao.x=parseFloat(D.x)+0;ao.y=parseFloat(D.y)+0;an.x=parseFloat(D.x)+0;an.y=parseFloat(D.y)+0;break}break}var am=[ap,ao,an];return am}var ae={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(an){var D="";var av,at,aq,au,ar,ap,ao;var am=0;an=ae._utf8_encode(an);while(am<an.length){av=an.charCodeAt(am++);at=an.charCodeAt(am++);aq=an.charCodeAt(am++);au=av>>2;ar=((av&3)<<4)|(at>>4);ap=((at&15)<<2)|(aq>>6);ao=aq&63;if(isNaN(at)){ap=ao=64}else{if(isNaN(aq)){ao=64}}D=D+this._keyStr.charAt(au)+this._keyStr.charAt(ar)+this._keyStr.charAt(ap)+this._keyStr.charAt(ao)}return D},decode:function(an){var D="";var av,at,aq;var au,ar,ap,ao;var am=0;an=an.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(am<an.length){au=this._keyStr.indexOf(an.charAt(am++));ar=this._keyStr.indexOf(an.charAt(am++));ap=this._keyStr.indexOf(an.charAt(am++));ao=this._keyStr.indexOf(an.charAt(am++));av=(au<<2)|(ar>>4);at=((ar&15)<<4)|(ap>>2);aq=((ap&3)<<6)|ao;D=D+String.fromCharCode(av);if(ap!=64){D=D+String.fromCharCode(at)}if(ao!=64){D=D+String.fromCharCode(aq)}}D=ae._utf8_decode(D);return D},_utf8_encode:function(am){am=am.replace(/\r\n/g,"\n");var D="";for(var ao=0;ao<am.length;ao++){var an=am.charCodeAt(ao);if(an<128){D+=String.fromCharCode(an)}else{if((an>127)&&(an<2048)){D+=String.fromCharCode((an>>6)|192);D+=String.fromCharCode((an&63)|128)}else{D+=String.fromCharCode((an>>12)|224);D+=String.fromCharCode(((an>>6)&63)|128);D+=String.fromCharCode((an&63)|128)}}}return D},_utf8_decode:function(D){var am="";var an=0;var ao=c1=c2=0;while(an<D.length){ao=D.charCodeAt(an);if(ao<128){am+=String.fromCharCode(ao);an++}else{if((ao>191)&&(ao<224)){c2=D.charCodeAt(an+1);am+=String.fromCharCode(((ao&31)<<6)|(c2&63));an+=2}else{c2=D.charCodeAt(an+1);c3=D.charCodeAt(an+2);am+=String.fromCharCode(((ao&15)<<12)|((c2&63)<<6)|(c3&63));an+=3}}}return am}};var z=new m();z.init();var H=window.location.search;if(H){var p=H.split("?");z.load(p[1]);z.first_playfield()}$("#save-button").click(function(){if($("input[name=export]:checked").val()=="All"){if($("input[name=exporturl]:checked").val()=="url"){z.export_all_to_url();$("#export").select()}else{if($("input[name=exporturl]:checked").val()=="urledit"){z.export_all_to_edit_url();$("#export").select()}else{if($("input[name=exporturl]:checked").val()=="forum"){z.export_all_to_forum();$("#export").select()}else{z.save();$("#export").select()}}}}if($("input[name=export]:checked").val()=="Current"){if($("input[name=exporturl]:checked").val()=="url"){z.Playfields[z.current_playfield].export_to_url();$("#export").select()}else{if($("input[name=exporturl]:checked").val()=="urledit"){z.Playfields[z.current_playfield].export_to_edit_url();$("#export").select()}else{if($("input[name=exporturl]:checked").val()=="forum"){z.Playfields[z.current_playfield].export_to_forum();$("#export").select()}else{z.Playfields[z.current_playfield].export_pf();$("#export").select()}}}}});$("#load-button").click(function(){if($("input[name=export]:checked").val()=="All"){var D=$("#import").val();z.load(D)}if($("input[name=export]:checked").val()=="Current"){var am=$("#import").val();z.Playfields[z.current_playfield].load_pf(am)}});var P=$("body");P.mousedown(function(){o=1;n=0}).mouseup(function(){o=0;n=0;F=0});$("#diagram td").hover(function(){var am=$(this).attr("id");var ap=$("input[type=radio][name=tetramino]:checked").attr("class");var ao=$("input[type=radio][name=tetramino]:checked").attr("value");var aq=$("#active").attr("checked");if(n){z.Playfields[z.current_playfield].modify_set_piece(am,"inactive","_",ao)}else{if(o){if(ap=="decoration"){var ar=clicked.indexOf("p");var an=clicked.indexOf("x");var D=parseInt(clicked.substring(ar+1,an));var at=parseInt(clicked.substring(an+1));if(z.Playfields[z.current_playfield].lookup_decoration(clicked)&&z.Playfields[z.current_playfield].lookup_decoration(clicked)==ao){z.Playfields[z.current_playfield].modify_decoration(D,at,"")}else{z.Playfields[z.current_playfield].modify_decoration(D,at,ao)}}else{if(aq){z.Playfields[z.current_playfield].modify_set_piece(am,"active",ap,ao)}else{if(z.Playfields[z.current_playfield].lookup_block(am)!="_"&&z.Playfields[z.current_playfield].lookup_block(clicked)==ap){z.Playfields[z.current_playfield].modify_set_piece(am,"inactive","_",ao)}else{z.Playfields[z.current_playfield].modify_set_piece(am,"inactive",ap,ao)}}}}else{z.Playfields[z.current_playfield].modify_set_piece($(this).attr("id"),"addpreview",ap,ao,aq)}}},function(){var am=$("input[type=radio][name=tetramino]:checked").attr("class");var D=$("input[type=radio][name=tetramino]:checked").attr("value");var an=$("#active").attr("checked");z.Playfields[z.current_playfield].modify_set_piece($(this).attr("id"),"removepreview",am,D,an)});var X,B,Y,c;var ab;$("#diagram td").mousedown(function(){var av=$(this).attr("id");var az=$("input[type=radio][name=tetramino]:checked").attr("class");var am=$("input[type=radio][name=tetramino]:checked").attr("value");var at=$("#active").attr("checked");var aq=$("#rectangular-fill").attr("checked");var an=$("#recursive-fill").attr("checked");var ar=$("#advance").attr("checked");var ay=$("#paintactive").attr("checked");if(az=="decoration"){var ap=av.indexOf("p");var D=av.indexOf("x");var ax=parseInt(av.substring(ap+1,D));var aw=parseInt(av.substring(D+1));if(z.Playfields[z.current_playfield].lookup_decoration(av)&&z.Playfields[z.current_playfield].lookup_decoration(av)==am){z.Playfields[z.current_playfield].modify_decoration(ax,aw,"")}else{z.Playfields[z.current_playfield].modify_decoration(ax,aw,am)}}else{if(aq){if(ab){$("#p"+X+"x"+Y).css("background-color","");B=av.slice(1,av.indexOf("x"));c=av.slice(av.indexOf("x")+1);z.Playfields[z.current_playfield].rectangular_fill(X,Y,B,c,az);ab=false;$("#rectangular-fill").removeAttr("checked")}else{X=av.slice(1,av.indexOf("x"));Y=av.slice(av.indexOf("x")+1);ab=true;$("#"+av).css("background-color","green")}}else{if(an){var ao=av.slice(1,av.indexOf("x"));var au=av.slice(av.indexOf("x")+1);z.Playfields[z.current_playfield].recursive_fill(ao,au,z.Playfields[z.current_playfield].lookup_block(av),az)}else{if(at){z.Playfields[z.current_playfield].modify_set_piece(av,"active",az,am)}else{if(z.Playfields[z.current_playfield].lookup_block(av)!="_"&&z.Playfields[z.current_playfield].lookup_block(av)==az){z.Playfields[z.current_playfield].modify_set_piece(av,"inactive","_",am)}else{z.Playfields[z.current_playfield].modify_set_piece(av,"inactive",az,am)}}}}}if(ay){z.Playfields[z.current_playfield].paint_active();z.Playfields[z.current_playfield].draw()}if(ar){z.new_copy_playfield()}});var q=$("#active");var J=$("#recursive-fill");var N=$("#rectangular-fill");q.click(function(){J.removeAttr("disabled","");N.removeAttr("disabled","");if(q.attr("checked")){J.attr("disabled","disabled");N.attr("disabled","disabled")}});$("#com").change(function(){z.Playfields[z.current_playfield].save_comment()});$("#stackborder").change(function(){if($("#stackborder:checked").val()){z.Playfields[z.current_playfield].stackborder_status=1}else{z.Playfields[z.current_playfield].stackborder_status=0}z.Playfields[z.current_playfield].draw_stackborder(z.Playfields[z.current_playfield].stackborder_status)});$(".size-change","#properties").change(function(){if($("#size-all:checked").val()){z.Playfields[z.current_playfield].change_size($("#width").val(),$("#height").val())}for(var D=0;D<z.Playfields.length;D++){z.Playfields[D].change_size($("#width").val(),$("#height").val())}z.Playfields[z.current_playfield].change_size_display()});$("#size-change-reset").click(function(){aa=10;ad=20;for(var D=0;D<z.Playfields.length;D++){z.Playfields[D].change_size(10,20)}z.Playfields[z.current_playfield].change_size_display()});$("#cmd_size_default").click(function(){aa=$("#width").val();ad=$("#height").val()});$("#cmd_spawn").click(function(){var D=$("input[type=radio][name=tetramino]:checked").attr("class");z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].spawn_piece(D)});$("#cmd_hold").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].switchhold()});$("#cmd_advance_next").click(function(){z.Playfields[z.current_playfield].advance_next()});$("#border_color").change(function(){if($("#border_all:checked").val()){z.set_border_to_all($("#border_color").val())}else{z.Playfields[z.current_playfield].modify_border($("#border_color").val())}});$("#cmd_border_default").click(function(){z.set_default_border($("#border_color").val())});$("#cmd_border_reset").click(function(){if($("#border_all:checked").val()){z.set_border_to_all($(""))}else{z.Playfields[z.current_playfield].modify_border("")}});$("#hold").change(function(){z.Playfields[z.current_playfield].modify_hold($("#hold").val())});$("#next1").change(function(){z.Playfields[z.current_playfield].modify_next1($("#next1").val())});$("#next2").change(function(){z.Playfields[z.current_playfield].modify_next2($("#next2").val())});$("#next3").change(function(){z.Playfields[z.current_playfield].modify_next3($("#next3").val())});$("#cmd_new").click(function(){z.new_playfield()});$("#cmd_next").click(function(){if(z.current_playfield==z.Playfields.length-1){z.new_copy_playfield()}else{z.next_playfield()}});$("#cmd_prev").click(function(){z.previous_playfield()});$("#cmd_last").click(function(){z.last_playfield()});$("#cmd_first").click(function(){z.first_playfield()});$("#cmd_new_copy").click(function(){z.new_copy_playfield()});$("#cmd_del").click(function(){z.remove_current_playfield()});$("#cmd_del_follow").click(function(){var D=confirm("This will remove every frame after the current one. \n Are you sure ?");if(D){z.remove_following_playfields()}});$("#cmd_del_all").click(function(){var D=confirm("This will nuke everything ! \n Are you sure ?");if(D){z.remove_all_playfields()}});$("#cmd_up").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("up")});$("#cmd_down").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("down")});$("#cmd_left").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("left")});$("#cmd_right").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("right")});$("#cmd_cw").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("cw")});$("#cmd_ccw").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("ccw")});$("#cmd_recall").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Recall()});$("#cmd_clearactive").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].rebootActive()});$("#cmd_paintactive").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].paint_active()});$("#cmd_lockactive").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].lock_active()});$("#cmd_dropactive").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].drop_active_piece()});$("#cmd_line_clear").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].line_clear()});$("#cmd_shift_field_up").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("up")});$("#cmd_shift_field_down").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("down")});$("#cmd_shift_field_left").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("left")});$("#cmd_shift_field_right").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("right")});$("#cmd_clear_field").click(function(){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].rebootPlayfield();z.Playfields[z.current_playfield].draw()});$("#system").change(function(){var D=$("#system").val();if($("#system_all:checked").val()){z.set_system_to_all(D)}else{z.Playfields[z.current_playfield].modify_system(D)}});$("#system-change-default").click(function(){var D=$("#system").val();z.set_default_system(D)});var ac;var M;var aj;var Z;var h;var C;var E;var V;var I;var A;var ag;var ac;var K;var af;var l;var g;var e;var d;var b;var a;var al;var ak;function S(){ac=16;M=87;aj=65;kb_right=68;h=83;C=72;E=71;V=79;I=38;A=37;ag=39;ac=16;K=75;kb_browse_next=73;kb_browse_previous=85;l=49;g=50;e=51;d=52;b=53;a=54;al=55;ak=56;$("#kb_modifier").val(ac);$("#kb_up").val(M);$("#kb_left").val(aj);$("#kb_right").val(kb_right);$("#kb_down").val(h);$("#kb_ccw").val(C);$("#kb_cw").val(E);$("#kb_del").val(V);$("#kb_new").val(I);$("#kb_previous").val(A);$("#kb_next").val(ag);$("#kb_paint").val(K);$("#kb_browse_next").val(kb_browse_next);$("#kb_browse_previous").val(kb_browse_previous);$("kb_1").val(l);$("kb_2").val(g);$("kb_3").val(e);$("kb_4").val(d);$("kb_5").val(b);$("kb_6").val(a);$("kb_7").val(al);$("kb_8").val(ak)}S();if(readCookie("kb_modifier")){ac=readCookie("kb_modifier")}$("#kb_modifier").val(ac);if(readCookie("kb_up")){M=readCookie("kb_up")}$("#kb_up").val(M);if(readCookie("kb_left")){aj=readCookie("kb_left")}$("#kb_left").val(aj);if(readCookie("kb_right")){kb_right=readCookie("kb_right")}$("#kb_right").val(kb_right);if(readCookie("kb_down")){h=readCookie("kb_down")}$("#kb_down").val(h);if(readCookie("kb_ccw")){C=readCookie("kb_ccw")}$("#kb_ccw").val(C);if(readCookie("kb_cw")){E=readCookie("kb_cw")}$("#kb_cw").val(E);if(readCookie("kb_del")){V=readCookie("kb_del")}$("#kb_del").val(V);if(readCookie("kb_new")){I=readCookie("kb_new")}$("#kb_new").val(I);if(readCookie("kb_previous")){A=readCookie("kb_previous")}$("#kb_previous").val(A);if(readCookie("kb_next")){ag=readCookie("kb_next")}$("#kb_next").val(ag);if(readCookie("kb_paint")){K=readCookie("kb_paint")}$("#kb_paint").val(K);if(readCookie("kb_browse_next")){kb_browse_next=readCookie("kb_browse_next")}$("#kb_browse_next").val(kb_browse_next);if(readCookie("kb_browse_previous")){kb_browse_previous=readCookie("kb_browse_previous")}$("#kb_browse_previous").val(kb_browse_previous);if(readCookie("kb_1")){kb_browse_previous=readCookie("kb_1")}$("#kb_1").val(l);if(readCookie("kb_2")){kb_browse_previous=readCookie("kb_2")}$("#kb_2").val(g);if(readCookie("kb_3")){kb_browse_previous=readCookie("kb_3")}$("#kb_3").val(e);if(readCookie("kb_4")){kb_browse_previous=readCookie("kb_4")}$("#kb_4").val(d);if(readCookie("kb_5")){kb_browse_previous=readCookie("kb_5")}$("#kb_5").val(b);if(readCookie("kb_6")){kb_browse_previous=readCookie("kb_6")}$("#kb_6").val(a);if(readCookie("kb_7")){kb_browse_previous=readCookie("kb_7")}$("#kb_7").val(al);if(readCookie("kb_8")){kb_browse_previous=readCookie("kb_8")}$("#kb_8").val(ak);$("#kb_modifier").change(function(){M=$("#kb_modifier").val()});$("#kb_up").change(function(){M=$("#kb_up").val()});$("#kb_down").change(function(){h=$("#kb_down").val()});$("#kb_left").change(function(){aj=$("#kb_left").val()});$("#kb_right").change(function(){kb_right=$("#kb_right").val()});$("#kb_cw").change(function(){E=$("#kb_cw").val()});$("#kb_ccw").change(function(){C=$("#kb_ccw").val()});$("#kb_del").change(function(){V=$("#kb_del").val()});$("#kb_new").change(function(){I=$("#kb_new").val()});$("#kb_previous").change(function(){A=$("#kb_previous").val()});$("#kb_next").change(function(){ag=$("#kb_next").val()});$("#kb_paint").change(function(){K=$("#kb_paint").val()});$("#kb_browse_previous").change(function(){kb_browse_previous=$("#kb_browse_previous").val()});$("#kb_browse_next").change(function(){kb_browse_next=$("#kb_browse_next").val()});$("#kb_1").change(function(){I=$("#kb_1").val()});$("#kb_2").change(function(){I=$("#kb_2").val()});$("#kb_3").change(function(){I=$("#kb_3").val()});$("#kb_4").change(function(){I=$("#kb_4").val()});$("#kb_5").change(function(){I=$("#kb_5").val()});$("#kb_6").change(function(){I=$("#kb_6").val()});$("#kb_7").change(function(){I=$("#kb_7").val()});$("#kb_8").change(function(){I=$("#kb_8").val()});$(window).keydown(function(D){var am;if(ac==16||ac==17||ac==18){if(D.shiftKey){am=true}if(D.ctrlKey){am=true}if(D.alttKey){am=true}}if($("#kb-control-status:checked").val()!=null){if(am){if(D.keyCode==M){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("up")}if(D.keyCode==aj){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("left")}if(D.keyCode==kb_right){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("right")}if(D.keyCode==h){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].shift_field("down")}if(D.keyCode==I){z.new_copy_playfield()}if(D.keyCode==V){z.remove_following_playfields()}if(D.keyCode==A){z.first_playfield()}if(D.keyCode==ag){z.last_playfield()}if(D.keyCode==K){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].lock_active()}}else{if(D.keyCode==M){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("up")}if(D.keyCode==aj){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("left")}if(D.keyCode==kb_right){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("right")}if(D.keyCode==h){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("down")}if(D.keyCode==C){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("ccw")}if(D.keyCode==E){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].move_piece("cw")}if(D.keyCode==I){z.new_playfield()}if(D.keyCode==V){z.remove_current_playfield()}if(D.keyCode==A){z.previous_playfield()}if(D.keyCode==ag){if(z.current_playfield==z.Playfields.length-1){z.new_copy_playfield()}else{z.next_playfield()}}if(D.keyCode==K){z.Playfields[z.current_playfield].Tetrion_History_Save();z.Playfields[z.current_playfield].paint_active()}if(D.keyCode==kb_browse_previous){W()}if(D.keyCode==kb_browse_next){ah()}if(D.keyCode==l){s()}if(D.keyCode==g){x()}if(D.keyCode==e){u()}if(D.keyCode==d){r()}if(D.keyCode==b){w()}if(D.keyCode==a){t()}if(D.keyCode==al){y()}if(D.keyCode==ak){v()}}}});$("#kb-control-save").click(function(){eraseCookie("kb_modifier");eraseCookie("kb_up");eraseCookie("kb_up");eraseCookie("kb_down");eraseCookie("kb_left");eraseCookie("kb_right");eraseCookie("kb_cw");eraseCookie("kb_ccw");eraseCookie("kb_del");eraseCookie("kb_new");eraseCookie("kb_previous");eraseCookie("kb_next");eraseCookie("kb_browse_previous");eraseCookie("kb_browse_next");eraseCookie("kb_1");eraseCookie("kb_2");eraseCookie("kb_3");eraseCookie("kb_4");eraseCookie("kb_5");eraseCookie("kb_6");eraseCookie("kb_7");eraseCookie("kb_8");createCookie("kb_modifier",ac);createCookie("kb_up",M);createCookie("kb_down",h);createCookie("kb_left",aj);createCookie("kb_right",kb_right);createCookie("kb_cw",E);createCookie("kb_ccw",C);createCookie("kb_del",V);createCookie("kb_new",I);createCookie("kb_previous",A);createCookie("kb_next",ag);createCookie("kb_browse_previous",kb_browse_previous);createCookie("kb_browse_next",kb_browse_next);createCookie("kb_1",l);createCookie("kb_2",g);createCookie("kb_3",e);createCookie("kb_4",d);createCookie("kb_5",b);createCookie("kb_6",a);createCookie("kb_7",al);createCookie("kb_8",ak);createCookie("kb_1",l);createCookie("kb_1",l)});$("#kb-control-default").click(function(){S()});$('#palette input[name="tetramino"]').click(function(){if($(this).is(":checked")){$('#palette input[name="tetramino"]').parent().removeClass("boxcheck");$(this).parent().addClass("boxcheck")}});var R=0;var T=$('input[name="tetramino"]').length;var L=9;var Q=0;function s(){if(L!=1){L=1;Q=0}if(Q<$('#pr1 input[name="tetramino"]').length){$('#pr1 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr1 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr1 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr1 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr1 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr1 input[name="tetramino"]')[R]).attr("class"))}}}function x(){if(L!=2){L=2;Q=0}if(Q<$('#pr2 input[name="tetramino"]').length){$('#pr2 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr2 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr2 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr2 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr2 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr2 input[name="tetramino"]')[R]).attr("class"))}}}function u(){if(L!=3){L=3;Q=0}if(Q<$('#pr3 input[name="tetramino"]').length){$('#pr3 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr3 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr3 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr3 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr3 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr3 input[name="tetramino"]')[R]).attr("class"))}}}function r(){if(L!=4){L=4;Q=0}if(Q<$('#pr4 input[name="tetramino"]').length){$('#pr4 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr4 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr4 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr4 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr4 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr4 input[name="tetramino"]')[R]).attr("class"))}}}function w(){if(L!=5){L=5;Q=0}if(Q<$('#pr5 input[name="tetramino"]').length){$('#pr5 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr5 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr5 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr5 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr5 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr5 input[name="tetramino"]')[R]).attr("class"))}}}function t(){if(L!=6){L=6;Q=0}if(Q<$('#pr6 input[name="tetramino"]').length){$('#pr6 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr6 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr6 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr6 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr6 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr6 input[name="tetramino"]')[R]).attr("class"))}}}function y(){if(L!=7){L=7;Q=0}if(Q<$('#pr7 input[name="tetramino"]').length){$('#pr7 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr7 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr7 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr7 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr7 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr7 input[name="tetramino"]')[R]).attr("class"))}}}function v(){if(L!=8){L=8;Q=0}if(Q<$('#pr8 input[name="tetramino"]').length){$('#pr8 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr8 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr8 input[name="tetramino"]')[R]).attr("class"))}Q++}else{Q=0;$('#pr8 input[name="tetramino"]')[Q].checked=true;$($('input[name="tetramino"]')).parent().removeClass("boxcheck");$($('#pr8 input[name="tetramino"]')[Q]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('#pr8 input[name="tetramino"]')[R]).attr("class"))}}}function ah(){if(R<T){R++;$('input[name="tetramino"]')[R].checked=true;$('input[name="tetramino"]').parent().removeClass("boxcheck");$($('input[name="tetramino"]')[R]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('input[name="tetramino"]')[R]).attr("class"))}}else{R=0}}function W(){if(R>0){R--;$('input[name="tetramino"]')[R].checked=true;$('input[name="tetramino"]').parent().removeClass("boxcheck");$($('input[name="tetramino"]')[R]).parent().addClass("boxcheck");if($("#active").attr("checked")){z.Playfields[z.current_playfield].spawn_piece($($('input[name="tetramino"]')[R]).attr("class"))}}else{R=T}}});function createCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"}function readCookie(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null}function eraseCookie(a){createCookie(a,"",-1)};